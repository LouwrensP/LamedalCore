<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>d:\dev\lamedal\trunk\lamedalcore\lamedalcore\zpublicclass\exceldata\pcexceldata_.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Drawing;
using LamedalCore.domain.Attributes;
using LamedalCore.domain.Enumerals;
using LamedalCore.lib.Excel;
using LamedalCore.zz;
using LamedalExcel;

namespace LamedalCore.zPublicClass.ExcelData
{
    /// &lt;summary&gt;Public class to access excel data files&lt;/summary&gt;
    public sealed class pcExcelData_
    {
        private readonly LamedalCore_ _lamed = LamedalCore_.Instance;
        private readonly Excel_ _excel = LamedalCore_.Instance.lib.Excel;
        internal Worksheet _sheet = null;

        private readonly List&lt;List&lt;string&gt;&gt; _rows = new List&lt;List&lt;string&gt;&gt;();

        /// &lt;summary&gt;
        /// Save the Worksheet 
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        internal Worksheet Worksheet
        {
            get { return _sheet; }
        }

        /// &lt;summary&gt;Gets the cells.&lt;/summary&gt;
        public List&lt;List&lt;string&gt;&gt; Rows
        {
            get { return _rows; }
        }

        public List&lt;List&lt;string&gt;&gt; Columns
        {
            get { return Columns_Get(); }
        }

        /// &lt;summary&gt;Return the Columns.&lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private List&lt;List&lt;string&gt;&gt; Columns_Get()
        {
            var cols = new List&lt;List&lt;string&gt;&gt;();
            var colMax = 1;
            var index = 0;
            while (index &lt; colMax)
            {
                var col = new List&lt;string&gt;();
                foreach (List&lt;string&gt; row in _rows)
                {
                    if (index &lt; row.Count)
                        col.Add(row[index]);
                    else col.Add(&quot;&quot;);
                    if (index == 0 &amp;&amp; row.Count &gt; colMax) colMax = row.Count; // Get the max col count.
                }
                cols.Add(col);
                index++;
            }
            return cols;
        }

        /// &lt;summary&gt;Gets the col count.&lt;/summary&gt;
        public int Col_Count
        {
            get { return _rows.Count == 0 ? 0 : _rows[0].Count; }
        }

        /// &lt;summary&gt;Gets the row count.&lt;/summary&gt;
        public int Row_Count
        {
            get { return _rows.Count; }
        }

        /// &lt;summary&gt;Return the specific row&lt;/summary&gt;
        /// &lt;param name=&quot;rowNo&quot;&gt;The row no.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public string[] Row(int rowNo)
        {
            if (rowNo &lt;= 0) new ArgumentException(&quot;RowNo must be greater than 1&quot;, nameof(rowNo));
            if (rowNo &gt; Row_Count) new ArgumentException($&quot;RowNo must be smaller than {Row_Count}&quot;, nameof(rowNo));

            var row = _rows[rowNo - 1];
            return row.ToArray();
        }

        /// &lt;summary&gt;Gets the cell value&lt;/summary&gt;
        /// &lt;param name=&quot;col&quot;&gt;The col.&lt;/param&gt;
        /// &lt;param name=&quot;row&quot;&gt;The row.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public string Value_Get(int col, int row)
        {
            return _lamed.lib.Excel.Data.Value_Get(this, col, row);
        }

        /// &lt;summary&gt;Gets the cell value&lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public string Value_Get(string cellName)
        {
            return _lamed.lib.Excel.Data.Value_Get(this, cellName);
        }

        [Test_IgnoreCoverage(enTestIgnore.MethodIsShortCut)]
        public void Macro_Compile()
        {
            string errorMsg;
            _excel.Macro.Compile(this, out errorMsg);
        }

        /// &lt;summary&gt;Executeutablecutes the tdata macro.&lt;/summary&gt;
        /// &lt;param name=&quot;dataSource&quot;&gt;The data source&lt;/param&gt;
        [Test_IgnoreCoverage(enTestIgnore.MethodIsShortCut)]
        public void Macro_Execute(pcExcelData_ dataSource)
        {
            _excel.Macro.Execute_Data(dataSource, this);
        }

        /// &lt;summary&gt;Sets the value of a cell&lt;/summary&gt;
        /// &lt;param name=&quot;col&quot;&gt;The col.&lt;/param&gt;
        /// &lt;param name=&quot;row&quot;&gt;The row.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;The value.&lt;/param&gt;
        [Test_IgnoreCoverage(enTestIgnore.MethodIsShortCut)]
        public void Value_Set(int col, int row, string value)
        {
            _lamed.lib.Excel.Data.Value_Set(this, col, row, value);
        }

        /// &lt;summary&gt;Sets the value of a cell&lt;/summary&gt;
        /// &lt;param name=&quot;cellRef&quot;&gt;The cell reference.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;The value.&lt;/param&gt;
        public void Value_Set(string cellRef = &quot;A1&quot;, string value = &quot;&quot;)
        {
            _lamed.lib.Excel.Data.Value_Set(this, cellRef, value);
        }

        /// &lt;summary&gt;Load the CSV file.&lt;/summary&gt;
        /// &lt;param name=&quot;csvFilename&quot;&gt;The CSV filename.&lt;/param&gt;
        [Test_IgnoreCoverage(enTestIgnore.MethodIsShortCut)]
        public void csvLoadFromFile(string csvFilename)
        {
            // Read the CSV file and populate the data structure
            string[] lines = _lamed.lib.IO.RW.File_Read2StrArray(csvFilename);
            csvLoadFromLines(lines);
        }

        /// &lt;summary&gt;Loads the from csv lines.&lt;/summary&gt;
        /// &lt;param name=&quot;lines&quot;&gt;The lines.&lt;/param&gt;
        public void csvLoadFromLines(params string[] lines)
        {
            _lamed.lib.Excel.Csv.DataRows_FromCsvLines(Rows, lines);
        }


        /// &lt;summary&gt;Saves the file to CSV&lt;/summary&gt;
        /// &lt;param name=&quot;csvFilename&quot;&gt;The CSV filename.&lt;/param&gt;
        /// &lt;param name=&quot;overwrite&quot;&gt;if set to &lt;c&gt;true&lt;/c&gt; [overwrite].&lt;/param&gt;
        public void csvSave2File(string csvFilename, bool overwrite = false)
        {
            _lamed.lib.Excel.Csv.DataRows_2csvFile(csvFilename, Rows, overwrite);
        }

        /// &lt;summary&gt;Normalizes the rows to all have equal values.&lt;/summary&gt;
        public pcExcelData_ Normalize()
        {
            _lamed.lib.Excel.Data.Normalize(this.Rows);
            return this;
        }

        /// &lt;summary&gt;Finds the specified value in the sheet.&lt;/summary&gt;
        /// &lt;param name=&quot;findValue&quot;&gt;The find value.&lt;/param&gt;
        /// &lt;param name=&quot;compare&quot;&gt;The compare formula to use.&lt;/param&gt;
        /// &lt;param name=&quot;returnType&quot;&gt;Type of the return.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [Test_IgnoreCoverage(enTestIgnore.MethodIsShortCut)]
        public List&lt;string&gt; Find(string findValue = &quot;|-&gt;&quot;, enExcel_Compare compare = enExcel_Compare.Contains,
            enExcel_FindReturnValue returnType = enExcel_FindReturnValue.CellValue)
        {
            return _lamed.lib.Excel.Adress.Find(this, findValue, compare, returnType);
        }

        /// &lt;summary&gt;Finds the first occurance.&lt;/summary&gt;
        /// &lt;param name=&quot;result&quot;&gt;The result.&lt;/param&gt;
        /// &lt;param name=&quot;findValue&quot;&gt;The find value.&lt;/param&gt;
        /// &lt;param name=&quot;compare&quot;&gt;The compare.&lt;/param&gt;
        /// &lt;param name=&quot;returnType&quot;&gt;Type of the return.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public bool Find_First(out string result, string findValue = &quot;|-&gt;&quot;,
            enExcel_Compare compare = enExcel_Compare.Contains,
            enExcel_FindReturnValue returnType = enExcel_FindReturnValue.CellValue)
        {
            return _lamed.lib.Excel.Adress.Find_First(this, out result, findValue, compare, returnType);
        }

        /// &lt;summary&gt;Creates a new Worksheet.&lt;/summary&gt;
        /// &lt;param name=&quot;sheetName&quot;&gt;Name of the sheet.&lt;/param&gt;
        /// &lt;param name=&quot;orientation&quot;&gt;The orientation.&lt;/param&gt;
        /// &lt;param name=&quot;workbookAuthor&quot;&gt;The workbook author.&lt;/param&gt;
        /// &lt;param name=&quot;workbookTitle&quot;&gt;The workbook title.&lt;/param&gt;
        public void WorkSheet_New(string sheetName, enExcel_Orientation orientation = enExcel_Orientation.Portrait, string workbookAuthor = &quot;&quot;, string workbookTitle = &quot;&quot;)
        {
            _lamed.lib.Excel.WorkSheet.WorkSheet_New(this, sheetName, workbookAuthor, workbookTitle, orientation);
        }

        /// &lt;summary&gt;Set the column width of the sheet.&lt;/summary&gt;
        /// &lt;param name=&quot;colNo&quot;&gt;The col no.&lt;/param&gt;
        /// &lt;param name=&quot;colWidth&quot;&gt;Width of the col.&lt;/param&gt;
        public void WorkSheet_ColumnWidth(int colNo, double colWidth)
        {
            _lamed.lib.Excel.WorkSheet.WorkSheet_ColumnWidth(this, colNo, colWidth);
        }

        /// &lt;summary&gt;Set the column width of the sheet.&lt;/summary&gt;
        /// &lt;param name=&quot;colName&quot;&gt;Name of the col.&lt;/param&gt;
        /// &lt;param name=&quot;colWidth&quot;&gt;Width of the col.&lt;/param&gt;
        [Test_IgnoreCoverage(enTestIgnore.MethodIsShortCut)]
        public void WorkSheet_ColumnWidth(string colName, double colWidth)
        {
            _lamed.lib.Excel.WorkSheet.WorkSheet_ColumnWidth(this, colName, colWidth);
        }

        /// &lt;summary&gt;Set the Cell value for the worksheet.&lt;/summary&gt;
        /// &lt;param name=&quot;col&quot;&gt;The col.&lt;/param&gt;
        /// &lt;param name=&quot;row&quot;&gt;The row.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;The value.&lt;/param&gt;
        /// &lt;param name=&quot;bold&quot;&gt;The bold.&lt;/param&gt;
        /// &lt;param name=&quot;underline&quot;&gt;The underline.&lt;/param&gt;
        /// &lt;param name=&quot;italic&quot;&gt;The italic.&lt;/param&gt;
        /// &lt;param name=&quot;fontSize&quot;&gt;Size of the font.&lt;/param&gt;
        /// &lt;param name=&quot;webLink&quot;&gt;The web link.&lt;/param&gt;
        /// &lt;param name=&quot;textColor&quot;&gt;Color of the text.&lt;/param&gt;
        /// &lt;param name=&quot;columnWidth&quot;&gt;Width of the column.&lt;/param&gt;
        /// &lt;param name=&quot;fontName&quot;&gt;Name of the font.&lt;/param&gt;
        /// &lt;param name=&quot;border&quot;&gt;The border.&lt;/param&gt;
        public void WorkSheet_CellSet(int col, int row, object value, bool? bold = null,
            bool? underline = null, bool? italic = null, int? fontSize = null, string webLink = null,
            Color? textColor = null, int? columnWidth = null, string fontName = null, enExcel_CellBorder? border = null)
        {
            var address = _lamed.lib.Excel.Adress.CellAddress(col, row);
            WorkSheet_CellSet(address, value, bold, underline, italic, fontSize, webLink, textColor, columnWidth, fontName, border);
        }

        /// &lt;summary&gt;Set the Cell value for the worksheet.&lt;/summary&gt;
        /// &lt;param name=&quot;cellName&quot;&gt;Name of the cell.&lt;/param&gt;
        /// &lt;param name=&quot;value&quot;&gt;The value.&lt;/param&gt;
        /// &lt;param name=&quot;bold&quot;&gt;The bold.&lt;/param&gt;
        /// &lt;param name=&quot;underline&quot;&gt;The underline.&lt;/param&gt;
        /// &lt;param name=&quot;italic&quot;&gt;The italic.&lt;/param&gt;
        /// &lt;param name=&quot;fontSize&quot;&gt;Size of the font.&lt;/param&gt;
        /// &lt;param name=&quot;webLink&quot;&gt;The web link.&lt;/param&gt;
        /// &lt;param name=&quot;textColor&quot;&gt;Color of the text.&lt;/param&gt;
        /// &lt;param name=&quot;columnWidth&quot;&gt;Width of the column.&lt;/param&gt;
        /// &lt;param name=&quot;fontName&quot;&gt;Name of the font.&lt;/param&gt;
        /// &lt;param name=&quot;border&quot;&gt;The border.&lt;/param&gt;
        public void WorkSheet_CellSet(string cellName, object value, bool? bold = null,
            bool? underline = null, bool? italic = null, int? fontSize = null, string webLink = null,
            Color? textColor = null, int? columnWidth = null, string fontName = null, enExcel_CellBorder? border = null)
        {
            Value_Set(cellName, value.zObject().AsStr());  // Save the value in the data
            _lamed.lib.Excel.WorkSheet.WorkSheet_CellSet(this, cellName, value, bold, underline, italic, fontSize,
                webLink, textColor, columnWidth, fontName, border);
        }

        /// &lt;summary&gt;Save the workbook&lt;/summary&gt;
        /// &lt;param name=&quot;fileName&quot;&gt;Name of the file.&lt;/param&gt;
        public void Workbook_Save(string fileName)
        {
            // Sync the worksheet
            var rowNo = 1;   
            foreach (List&lt;string&gt; row in Rows)
            {
                var colNo = 1;
                foreach (string value in row)
                {
                    _lamed.lib.Excel.WorkSheet.WorkSheet_CellSet(this, colNo, rowNo, value);
                    colNo++;
                }
                rowNo++;
            }

            if (fileName != &quot;&quot;) _lamed.lib.Excel.WorkSheet.Workbook_Save(this, fileName);
        }

        /// &lt;summary&gt;Close the Workbook. If a filename is given saves the workbook before the close&lt;/summary&gt;
        /// &lt;param name=&quot;fileName&quot;&gt;Name of the file.&lt;/param&gt;
        public void Workbook_Close(string fileName = &quot;&quot;)
        {
            Workbook_Save(fileName);
            _lamed.lib.Excel.WorkSheet.Workbook_Close(this);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[27,17,27,18,1],[27,19,27,33,1],[27,34,27,35,1],[33,17,33,18,1],[33,19,33,32,1],[33,33,33,34,1],[38,17,38,18,1],[38,19,38,40,1],[38,41,38,42,1],[44,9,44,10,1],[45,13,45,49,1],[46,13,46,28,1],[47,13,47,27,1],[49,13,49,14,1],[50,17,50,46,1],[51,17,51,24,1],[51,46,51,51,1],[51,26,51,42,1],[52,17,52,18,1],[53,21,53,43,1],[54,25,54,45,1],[55,26,55,38,1],[56,21,56,58,1],[56,59,56,78,1],[57,17,57,18,1],[51,43,51,45,1],[58,17,58,31,1],[59,17,59,25,1],[60,13,60,14,1],[48,13,48,35,1],[61,13,61,25,1],[62,9,62,10,1],[67,17,67,18,1],[67,19,67,64,1],[67,65,67,66,1],[73,17,73,18,1],[73,19,73,38,1],[73,39,73,40,1],[80,9,80,10,1],[81,13,81,28,1],[81,29,81,98,1],[82,13,82,35,1],[82,36,82,116,1],[84,13,84,40,1],[85,13,85,34,1],[86,9,86,10,1],[93,9,93,10,1],[94,13,94,68,1],[95,9,95,10,1],[100,9,100,10,1],[101,13,101,68,1],[102,9,102,10,1],[133,9,133,10,1],[134,13,134,67,1],[135,9,135,10,1],[150,9,150,10,1],[151,13,151,69,1],[152,9,152,10,1],[159,9,159,10,1],[160,13,160,82,1],[161,9,161,10,1],[165,9,165,10,1],[166,13,166,56,1],[167,13,167,25,1],[168,9,168,10,1],[191,9,191,10,1],[192,13,192,105,1],[193,9,193,10,1],[201,9,201,10,1],[202,13,202,115,1],[203,9,203,10,1],[209,9,209,10,1],[210,13,210,85,1],[211,9,211,10,1],[238,9,238,10,1],[239,13,239,73,1],[240,13,240,133,1],[241,9,241,10,1],[258,9,258,10,1],[259,13,259,58,1],[260,13,261,68,1],[262,9,262,10,1],[267,9,267,10,1],[269,13,269,27,1],[270,13,270,20,1],[270,42,270,46,1],[270,22,270,38,1],[271,13,271,14,1],[272,17,272,31,1],[273,17,273,24,1],[273,42,273,45,1],[273,26,273,38,1],[274,17,274,18,1],[275,21,275,93,1],[276,21,276,29,1],[277,17,277,18,1],[273,39,273,41,1],[278,17,278,25,1],[279,13,279,14,1],[270,39,270,41,1],[281,13,281,32,1],[281,33,281,90,1],[282,9,282,10,1],[287,9,287,10,1],[288,13,288,37,1],[289,13,289,61,1],[290,9,290,10,1],[15,9,15,70,1],[16,9,16,74,1],[17,9,17,42,1],[19,9,19,78,1]]);
    </script>
  </body>
</html>