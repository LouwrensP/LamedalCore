<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>d:\dev\lamedal\trunk\lamedalcore\lamedalcore\lib\io\io_stateinfo\io_stateinfo_rw2.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace LamedalCore.lib.IO.IO_StateInfo
{
    public sealed class IO_StateInfo_RW2 : IO_StateInfo_RW
    {
        private readonly LamedalCore_ _lamed = LamedalCore_.Instance;
        private IO_StateInfo_lvl2 _state;

        /// &lt;summary&gt;Gets the state.&lt;/summary&gt;
        public IO_StateInfo_lvl2 State
        {
            get { return _state; }
        }

        /// &lt;summary&gt;Gets or sets the name of the file. When file is set and it exists, contents will be loaded.&lt;/summary&gt;
        public override string FileName
        {
            set
            {
                base.FileName = value;
                if (_jsonStr == &quot;&quot;) _state = new IO_StateInfo_lvl2();  // This line need unit testing
                else _state = _lamed.lib.IO.Json.Convert_ToType&lt;IO_StateInfo_lvl2&gt;(_jsonStr);
            }
        }

        /// &lt;summary&gt;Sync an object with the data&lt;/summary&gt;
        /// &lt;param name=&quot;keyName1&quot;&gt;The key name1.&lt;/param&gt;
        /// &lt;param name=&quot;keyName2&quot;&gt;The key name2.&lt;/param&gt;
        /// &lt;param name=&quot;Object&quot;&gt;The object.&lt;/param&gt;
        /// &lt;param name=&quot;defaultFile&quot;&gt;The default file.&lt;/param&gt;
        public void Data_Load(string keyName1, string keyName2, object Object, string defaultFile = &quot;StateInfo_lvl2.json&quot;)
        {
            // This method need to be improved in a way that will save a ref to Object to be updated when everyhting is saved to disk.
            // This need to happen automatically.
            // =====================================================================
            var info = this;
            if (info.FileName == &quot;&quot;) info.InitialiseFile(defaultFile);
            var personStr = info.State.Data_Get(keyName1, keyName2);
            if (personStr != &quot;&quot;) _lamed.lib.IO.Json.Object_Set(Object, personStr); // Name &amp; Surname
        }

        /// &lt;summary&gt;Save the data to file.&lt;/summary&gt;
        /// &lt;param name=&quot;keyName1&quot;&gt;Name of the key.&lt;/param&gt;
        /// &lt;param name=&quot;keyName2&quot;&gt;The key name2.&lt;/param&gt;
        /// &lt;param name=&quot;person&quot;&gt;The person.&lt;/param&gt;
        /// &lt;param name=&quot;overwrite&quot;&gt;if set to &lt;c&gt;true&lt;/c&gt; [overwrite].&lt;/param&gt;
        public void Data_Save(string keyName1, string keyName2, object person, bool overwrite = false)
        {
            // This method need to be improved to have no parameters. 
            // It need update the referenced objects and save the new values to disk.
            // ========================================================================
            var info = this;
            var personStr = _lamed.lib.IO.Json.Convert_FromObject(person);
            info.State.Data_Add(keyName1, keyName2, personStr);
            info.Save(overwrite);
        }

        public override string ToString()
        {
            string json = _state.ToString();
            return json;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[25,37,25,70,0],[16,17,16,18,1],[16,19,16,33,1],[16,34,16,35,1],[23,13,23,14,1],[24,17,24,39,1],[25,17,25,36,1],[26,22,26,94,1],[27,13,27,14,1],[36,9,36,10,1],[40,13,40,29,1],[41,13,41,37,1],[41,38,41,71,1],[42,13,42,69,1],[43,13,43,33,1],[43,34,43,83,1],[44,9,44,10,1],[52,9,52,10,1],[56,13,56,29,1],[57,13,57,75,1],[58,13,58,64,1],[59,13,59,34,1],[60,9,60,10,1],[63,9,63,10,1],[64,13,64,45,1],[65,13,65,25,1],[66,9,66,10,1],[10,9,10,70,1]]);
    </script>
  </body>
</html>