<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>d:\dev\lamedal\trunk\lamedalcore\lamedalcore\lib\excel\excel_csv.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using LamedalCore.zz;

namespace LamedalCore.lib.Excel
{
    public sealed class Excel_Csv
    {
        private readonly LamedalCore_ _lamed = LamedalCore_.Instance;

        /// &lt;summary&gt;Saves the file to CSV&lt;/summary&gt;
        /// &lt;param name=&quot;csvFilename&quot;&gt;The CSV filename.&lt;/param&gt;
        /// &lt;param name=&quot;dataRows&quot;&gt;The data rows.&lt;/param&gt;
        /// &lt;param name=&quot;overwrite&quot;&gt;if set to &lt;c&gt;true&lt;/c&gt; [overwrite].&lt;/param&gt;
        public void DataRows_2csvFile(string csvFilename, List&lt;List&lt;string&gt;&gt; dataRows, bool overwrite = false)
        {
            var lines = new List&lt;string&gt;();
            foreach (List&lt;string&gt; row in dataRows)
            {
                var rowStr = row.zTo_Str(&quot;,&quot;);
                lines.Add(rowStr);
            }
            LamedalCore_.Instance.lib.IO.RW.File_Write(csvFilename, lines.ToArray(), overwrite);
        }

        /// &lt;summary&gt;Loads the from csv lines.&lt;/summary&gt;
        public void DataRows_FromCsvLines(List&lt;List&lt;string&gt;&gt; dataRows, string[] lines)
        {
            dataRows.Clear();
            foreach (var row in lines)
            {
                var rowList = DataRow_FromCsvLine(row, &#39;,&#39;, &#39;~&#39;); // Do not remove quotes
                dataRows.Add(rowList);
            }
            _lamed.lib.Excel.Data.Normalize(dataRows);
        }

        private List&lt;string&gt; DataRow_FromCsvLine(string row, char fieldSep = &#39;,&#39;, char strBackSlash = &#39;\&quot;&#39;)
        {
            bool quote = false;
            var strBuilder = new StringBuilder();
            var rowArray = new List&lt;string&gt;();

            var charArray = row.ToCharArray();
            foreach (char cc in charArray)
                if ((cc == fieldSep &amp;&amp; !quote))
                {
                    rowArray.Add(strBuilder.ToString().Trim());
                    strBuilder.Clear();
                }
                else
                {
                    if (cc == strBackSlash) quote = !quote;  // Unit test needed for this line
                    else strBuilder.Append(cc);
                }
            /* to solve the last element problem */
            rowArray.Add(strBuilder.ToString().Trim()); /* added this line */
            return rowArray;
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[56,45,56,60,0],[19,9,19,10,1],[20,13,20,44,1],[21,13,21,20,1],[21,42,21,50,1],[21,22,21,38,1],[22,13,22,14,1],[23,17,23,47,1],[24,17,24,35,1],[25,13,25,14,1],[21,39,21,41,1],[26,13,26,97,1],[27,9,27,10,1],[31,9,31,10,1],[32,13,32,30,1],[33,13,33,20,1],[33,33,33,38,1],[33,22,33,29,1],[34,13,34,14,1],[35,17,35,66,1],[36,17,36,39,1],[37,13,37,14,1],[33,30,33,32,1],[38,13,38,55,1],[39,9,39,10,1],[42,9,42,10,1],[43,13,43,32,1],[44,13,44,50,1],[45,13,45,47,1],[47,13,47,47,1],[48,13,48,20,1],[48,33,48,42,1],[48,22,48,29,1],[49,17,49,48,1],[50,17,50,18,1],[51,21,51,64,1],[52,21,52,40,1],[53,17,53,18,1],[55,17,55,18,1],[56,21,56,44,1],[57,26,57,48,1],[58,17,58,18,1],[48,30,48,32,1],[60,13,60,56,1],[61,13,61,29,1],[62,9,62,10,1],[12,9,12,70,1]]);
    </script>
  </body>
</html>