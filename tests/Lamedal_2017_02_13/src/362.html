<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>d:\dev\lamedal\trunk\lamedalcore\lamedalcore\domain\attributes\blueprint_attributes.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Reflection;

namespace LamedalCore.domain.Attributes
{
    /// &lt;summary&gt;
    /// This class return blueprint rule and data attributes.
    /// &lt;/summary&gt;
    public sealed class Blueprint_Attributes
    {
        private readonly LamedalCore_ _lamed = LamedalCore_.Instance;

        // Data
        private readonly BlueprintData_TableAttribute _dataClass;
        private readonly IList&lt;Tuple&lt;FieldInfo, BlueprintData_FieldAttribute&gt;&gt; _dataFields;
        private readonly IList&lt;Tuple&lt;PropertyInfo, BlueprintData_FieldAttribute&gt;&gt; _dataProperties;

        // Rules
        private readonly IList&lt;Tuple&lt;FieldInfo, BlueprintRule_FieldAttribute&gt;&gt; _ruleFields;
        private readonly IList&lt;Tuple&lt;PropertyInfo, BlueprintRule_FieldAttribute&gt;&gt; _ruleProperties;
        private readonly IList&lt;Tuple&lt;MethodInfo, BlueprintRule_MethodAttribute&gt;&gt; _ruleMethods;
        private readonly IList&lt;Tuple&lt;MethodInfo, BlueprintRule_MethodAliasDefAttribute&gt;&gt; _ruleMethodsAlias;
        private readonly BlueprintRule_ClassAttribute _ruleClass;
        private Type _ClassType;

        /// &lt;summary&gt;Initializes a new instance of the &lt;see cref=&quot;Blueprint_Attributes&quot;/&gt; class.&lt;/summary&gt;
        /// &lt;param name=&quot;classType&quot;&gt;Type of the class.&lt;/param&gt;
        public Blueprint_Attributes(Type classType)
        {
            _ClassType = classType;

            // Rules
            _ruleFields = _lamed.Types.Class.ClassAttributes.Find_Fields&lt;BlueprintRule_FieldAttribute&gt;(classType);
            _ruleProperties = _lamed.Types.Class.ClassAttributes.Find_Properties&lt;BlueprintRule_FieldAttribute&gt;(classType);
            _ruleMethods = _lamed.Types.Class.ClassAttributes.Find_Methods&lt;BlueprintRule_MethodAttribute&gt;(classType);
            _ruleMethodsAlias = _lamed.Types.Class.ClassAttributes.Find_Methods&lt;BlueprintRule_MethodAliasDefAttribute&gt;(classType);
            _lamed.Types.Class.ClassAttributes.Find_Class(classType, out _ruleClass);

            // Data
            _dataFields = _lamed.Types.Class.ClassAttributes.Find_Fields&lt;BlueprintData_FieldAttribute&gt;(classType);
            _dataProperties = _lamed.Types.Class.ClassAttributes.Find_Properties&lt;BlueprintData_FieldAttribute&gt;(classType);
            _lamed.Types.Class.ClassAttributes.Find_Class(classType, out _dataClass);
        }

        /// &lt;summary&gt;Gets the table information.&lt;/summary&gt;
        /// &lt;value&gt;The table information.&lt;/value&gt;
        public BlueprintData_TableAttribute Data_TableInfo {get { return _dataClass; } }

        /// &lt;summary&gt;Get the Blueprint data for the property or field.&lt;/summary&gt;
        /// &lt;param name=&quot;fieldName&quot;&gt;Name of the field.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public BlueprintData_FieldAttribute Data_Property(string fieldName)
        {
            // Searches the fields
            Tuple&lt;MemberInfo, BlueprintData_FieldAttribute&gt; fieldInfo;
            if (Find_FieldData(fieldName, out fieldInfo)) return fieldInfo.Item2;

            return null;
        }

        /// &lt;summary&gt;Gets the class blueprint rule.&lt;/summary&gt;
        public BlueprintRule_ClassAttribute Rule_Class { get { return _ruleClass; } }

        /// &lt;summary&gt;Get the Blueprint rule for the property or field.&lt;/summary&gt;
        /// &lt;param name=&quot;fieldName&quot;&gt;Name of the field.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public BlueprintRule_FieldAttribute Rule_Property(string fieldName)
        {
            // Searches the fields
            Tuple&lt;MemberInfo, BlueprintRule_FieldAttribute&gt; fieldInfo;
            if (Find_FieldRules(fieldName, out fieldInfo)) return fieldInfo.Item2;

            return null;
        }

        /// &lt;summary&gt;Return the method rule attribute.&lt;/summary&gt;
        /// &lt;param name=&quot;methodName&quot;&gt;Name of the method.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public BlueprintRule_MethodAttribute Rule_Method(string methodName)
        {
            foreach (var method in _ruleMethods)
            {
                if (method.Item1.Name == methodName) return method.Item2;
            }
            return null;
        }

        /// &lt;summary&gt;Return the method allias attribute.&lt;/summary&gt;
        /// &lt;param name=&quot;methodName&quot;&gt;Name of the method.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public BlueprintRule_MethodAliasDefAttribute Rule_MethodAlias(string methodName)
        {
            foreach (var method in _ruleMethodsAlias)
            {
                if (method.Item1.Name == methodName) return method.Item2;
            }
            return null;
        }

        /// &lt;summary&gt;Get the property of field member information.&lt;/summary&gt;
        /// &lt;param name=&quot;fieldName&quot;&gt;Name of the field.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public MemberInfo PropertyInfo(string fieldName)
        {
            MemberInfo result = _lamed.Types.Class.ClassInfo.Field_AsFieldInfo(_ClassType, fieldName);
            if (result == null) result = _lamed.Types.Class.ClassInfo.Property_AsPropertyInfo(_ClassType, fieldName);
            return result;
        }

        /// &lt;summary&gt;Searches for field or property with the blueprint attribute.&lt;/summary&gt;
        /// &lt;param name=&quot;fieldName&quot;&gt;Name of the field.&lt;/param&gt;
        /// &lt;param name=&quot;fieldInfo&quot;&gt;The field information.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private bool Find_FieldRules(string fieldName, out Tuple&lt;MemberInfo, BlueprintRule_FieldAttribute&gt; fieldInfo)
        {
            fieldInfo = null;
            // Searches the fields
            foreach (var field in _ruleFields)
            {
                if (field.Item1.Name == fieldName)
                {
                    fieldInfo = new Tuple&lt;MemberInfo, BlueprintRule_FieldAttribute&gt;(field.Item1, field.Item2);
                    return true;
                }
            }
            foreach (var property in _ruleProperties)
            {
                if (property.Item1.Name == fieldName)
                {
                    fieldInfo = new Tuple&lt;MemberInfo, BlueprintRule_FieldAttribute&gt;(property.Item1, property.Item2);
                    return true;
                }
            }
            return false;
        }

        /// &lt;summary&gt;Searches for field or property with the blueprint attribute.&lt;/summary&gt;
        /// &lt;param name=&quot;fieldName&quot;&gt;Name of the field.&lt;/param&gt;
        /// &lt;param name=&quot;fieldInfo&quot;&gt;The field information.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        private bool Find_FieldData(string fieldName, out Tuple&lt;MemberInfo, BlueprintData_FieldAttribute&gt; fieldInfo)
        {
            fieldInfo = null;
            // Searches the fields
            foreach (var field in _dataFields)
            {
                if (field.Item1.Name == fieldName)
                {
                    fieldInfo = new Tuple&lt;MemberInfo, BlueprintData_FieldAttribute&gt;(field.Item1, field.Item2);
                    return true;
                }
            }
            foreach (var property in _dataProperties)
            {
                if (property.Item1.Name == fieldName)
                {
                    fieldInfo = new Tuple&lt;MemberInfo, BlueprintData_FieldAttribute&gt;(property.Item1, property.Item2);
                    return true;
                }
            }
            return false;
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[48,65,48,66,0],[48,67,48,85,0],[48,86,48,87,0],[59,13,59,25,0],[74,13,74,25,0],[85,13,85,14,0],[86,13,86,25,0],[97,13,97,14,0],[98,13,98,25,0],[107,33,107,118,0],[126,13,126,14,0],[127,13,127,20,0],[127,38,127,53,0],[127,22,127,34,0],[128,13,128,14,0],[129,17,129,54,0],[130,17,130,18,0],[131,21,131,117,0],[132,21,132,33,0],[134,13,134,14,0],[127,35,127,37,0],[135,13,135,26,0],[161,13,161,14,0],[162,13,162,26,0],[12,9,12,70,1],[29,9,29,52,1],[30,9,30,10,1],[31,13,31,36,1],[34,13,34,115,1],[35,13,35,123,1],[36,13,36,118,1],[37,13,37,131,1],[38,13,38,86,1],[41,13,41,115,1],[42,13,42,123,1],[43,13,43,86,1],[44,9,44,10,1],[54,9,54,10,1],[57,13,57,58,1],[57,59,57,82,1],[60,9,60,10,1],[63,62,63,63,1],[63,64,63,82,1],[63,83,63,84,1],[69,9,69,10,1],[72,13,72,59,1],[72,60,72,83,1],[75,9,75,10,1],[81,9,81,10,1],[82,13,82,20,1],[82,36,82,48,1],[82,22,82,32,1],[83,13,83,14,1],[84,17,84,53,1],[84,54,84,74,1],[82,33,82,35,1],[87,9,87,10,1],[93,9,93,10,1],[94,13,94,20,1],[94,36,94,53,1],[94,22,94,32,1],[95,13,95,14,1],[96,17,96,53,1],[96,54,96,74,1],[94,33,94,35,1],[99,9,99,10,1],[105,9,105,10,1],[106,13,106,103,1],[107,13,107,32,1],[108,13,108,27,1],[109,9,109,10,1],[116,9,116,10,1],[117,13,117,30,1],[119,13,119,20,1],[119,35,119,46,1],[119,22,119,31,1],[120,13,120,14,1],[121,17,121,51,1],[122,17,122,18,1],[123,21,123,111,1],[124,21,124,33,1],[119,32,119,34,1],[136,9,136,10,1],[143,9,143,10,1],[144,13,144,30,1],[146,13,146,20,1],[146,35,146,46,1],[146,22,146,31,1],[147,13,147,14,1],[148,17,148,51,1],[149,17,149,18,1],[150,21,150,111,1],[151,21,151,33,1],[153,13,153,14,1],[146,32,146,34,1],[154,13,154,20,1],[154,38,154,53,1],[154,22,154,34,1],[155,13,155,14,1],[156,17,156,54,1],[157,17,157,18,1],[158,21,158,117,1],[159,21,159,33,1],[154,35,154,37,1],[163,9,163,10,1]]);
    </script>
  </body>
</html>