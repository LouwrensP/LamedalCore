<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>d:\dev\lamedal\trunk\lamedalcore\lamedalcore\lib\excel\excel_adress.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using LamedalCore.domain.Enumerals;
using LamedalCore.zPublicClass.ExcelData;
using LamedalCore.zz;

namespace LamedalCore.lib.Excel
{
    /// &lt;summary&gt;
    /// Order must be Col, Row
    /// &lt;/summary&gt;
    public sealed class Excel_Adress
    {
        /// &lt;summary&gt;Col number to cell name.&lt;/summary&gt;
        /// &lt;param name=&quot;columnNumber&quot;&gt;The colName number&lt;/param&gt;
        /// &lt;param name=&quot;showError&quot;&gt;if set to &lt;c&gt;true&lt;/c&gt; [show error].&lt;/param&gt;
        /// &lt;returns&gt;string&lt;/returns&gt;
        /// &lt;exception cref=&quot;System.ArgumentOutOfRangeException&quot;&gt;Error! Value can not be 0.&lt;/exception&gt;
        public string ColName_FromColNumber(int columnNumber, bool showError = true)
        {
            if (columnNumber &lt; 1)
            {
                if (showError) throw new ArgumentOutOfRangeException(nameof(columnNumber), &quot;Error! Value can not be 0.&quot;);
                return &quot;?&quot;;
            }

            int dividend = columnNumber;
            string columnName = &quot;&quot;;

            while (dividend &gt; 0)
            {
                int modulo = (dividend - 1) % 26;
                columnName = Convert.ToChar(65 + modulo) + columnName;
                dividend = (dividend - modulo) / 26;
            }
            return columnName;
        }

        /// &lt;summary&gt;Cell Name to int value.&lt;/summary&gt;
        /// &lt;param name=&quot;cellAddress&quot;&gt;The name&lt;/param&gt;
        /// &lt;returns&gt;int&lt;/returns&gt;
        public int ColName_2Int(string cellAddress = &quot;A1&quot;)
        {
            int row;
            string colName;
            ColRow_AsRefName(out colName, out row, cellAddress);  // if cellName = &quot;A1&quot; get the &quot;A&quot;

            int number = 0;
            int startValue = 1;
            for (int ii = colName.Length - 1; ii &gt;= 0; ii--)
            {
                char value = colName[ii];
                {
                    number += (value - &#39;A&#39; + 1) * startValue;
                    startValue *= 26;
                }
            }
            return number;
        }

        /// &lt;summary&gt;Calculate cell address from the row and col numbers.&lt;/summary&gt;
        /// &lt;param name=&quot;col&quot;&gt;The col&lt;/param&gt;
        /// &lt;param name=&quot;row&quot;&gt;The row&lt;/param&gt;
        /// &lt;param name=&quot;showError&quot;&gt;if set to &lt;c&gt;true&lt;/c&gt; [show error].&lt;/param&gt;
        /// &lt;returns&gt;string&lt;/returns&gt;
        /// &lt;exception cref=&quot;System.ArgumentOutOfRangeException&quot;&gt;Error! Value of argument can not be 0.&lt;/exception&gt;
        public string CellAddress(int col, int row, bool showError = true)
        {
            var rowStr = &quot;&quot;;
            if (row &lt; 1)
            {
                rowStr = &quot;?&quot;;
                if (showError) throw new ArgumentOutOfRangeException(nameof(row), &quot;Error! Value of argument can not be 0.&quot;);
            }
            else rowStr = rowStr + row;

            string colName = ColName_FromColNumber(col, showError);
            string result = colName + rowStr;
            return result;
        }

        /// &lt;summary&gt;Calculate cell address for the cell below on the next row.&lt;/summary&gt;
        /// &lt;param name=&quot;cellAddress&quot;&gt;The cell address.&lt;/param&gt;
        /// &lt;returns&gt;string&lt;/returns&gt;
        public string CellAddress_NextRow(string cellAddress)
        {
            int col, row;
            ColRow_AsInt(out col, out row, cellAddress);
            row++;
            return CellAddress(col, row);
        }

        /// &lt;summary&gt;Calculate cell address for the cell in the next column.&lt;/summary&gt;
        /// &lt;param name=&quot;cellAddress&quot;&gt;The cell address.&lt;/param&gt;
        /// &lt;returns&gt;string&lt;/returns&gt;
        public string CellAddress_NextCol(string cellAddress)
        {
            int col, row;
            ColRow_AsInt(out col, out row, cellAddress);
            col++;
            return CellAddress(col, row);
        }

        /// &lt;summary&gt;Parse cell and return the colName and the row.&lt;/summary&gt;
        /// &lt;param name=&quot;colName&quot;&gt;Return the colName&lt;/param&gt;
        /// &lt;param name=&quot;row&quot;&gt;Return the row&lt;/param&gt;
        /// &lt;param name=&quot;cellName&quot;&gt;The cell name setting. Default value = &quot;A1&quot;.&lt;/param&gt;
        public void ColRow_AsRefName(out string colName, out int row, string cellName = &quot;A1&quot;)
        {
            //string col = &quot;AB21&quot;;
            int startIndex = cellName.IndexOfAny(&quot;?0123456789&quot;.ToCharArray());
            if (startIndex == -1)
            {
                //$&quot;Error! Cellname &#39;{cellName}&#39; does not contain a number.&quot;.zException_Show();
                colName = cellName;
                row = 0;
                return;
            }
            colName = cellName.Substring(0, startIndex);
            var rowNo = cellName.Substring(startIndex);
            if (rowNo == &quot;?&quot;) row = 0;
            else row = Int32.Parse(rowNo);
        }

        /// &lt;summary&gt;Get the cell address&lt;/summary&gt;
        /// &lt;param name=&quot;col&quot;&gt;The col.&lt;/param&gt;
        /// &lt;param name=&quot;row&quot;&gt;The row.&lt;/param&gt;
        /// &lt;param name=&quot;cellName&quot;&gt;Name of the cell.&lt;/param&gt;
        public void ColRow_AsInt(out int col, out int row, string cellName = &quot;A1&quot;)
        {
            string colName;
            ColRow_AsRefName(out colName, out row, cellName);
            col = ColName_2Int(colName);
        }

        /// &lt;summary&gt;Calculateulates the range from cell. Default value = &quot;A1&quot;..&lt;/summary&gt;
        /// &lt;param name=&quot;cellStart&quot;&gt;Cell starts the setting. Default value = &quot;A1&quot;.&lt;/param&gt;
        /// &lt;param name=&quot;columns&quot;&gt;The add columns setting. Default value = 0.&lt;/param&gt;
        /// &lt;param name=&quot;rows&quot;&gt;The add rows setting. Default value = 0.&lt;/param&gt;
        /// &lt;returns&gt;string&lt;/returns&gt;
        public string Range(string cellStart = &quot;A1&quot;, int columns = 1, int rows = 1)
        {
            if (columns &lt; 1) &quot;Error! Columns must be 1 or greater!&quot;.zException_Show();
            if (rows &lt; 1) &quot;Error! Rows must be 1 or greater!&quot;.zException_Show();

            string colName;
            int row;
            ColRow_AsRefName(out colName, out row, cellStart);
            int colNo = ColName_2Int(colName);
            colNo += columns - 1;
            row += rows - 1;

            var result = CellAddress(colNo, row);
            return result;
        }

        /// &lt;summary&gt;Get the Reference point.&lt;/summary&gt;
        /// &lt;param name=&quot;data&quot;&gt;The data.&lt;/param&gt;
        /// &lt;param name=&quot;findValue&quot;&gt;The find value.&lt;/param&gt;
        /// &lt;param name=&quot;compare&quot;&gt;The compare formula to use.&lt;/param&gt;
        /// &lt;param name=&quot;returnType&quot;&gt;Specify what should be returned.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;string&gt; Find(pcExcelData_ data, string findValue = &quot;|-&gt;&quot;, enExcel_Compare compare = enExcel_Compare.Contains, enExcel_FindReturnValue returnType = enExcel_FindReturnValue.CellValue)
        {
           
            var result = new List&lt;string&gt;();
            int rowNo = 1;
            foreach (List&lt;string&gt; row in data.Rows)
            {
                var colNo = 1;
                foreach (string item in row)
                {
                    bool found = false;
                    if (compare == enExcel_Compare.Contains)
                    {
                         if (item.Contains(findValue)) found = true;
                    }
                    else if (item == findValue) found = true;

                    if (found)
                    {
                        if (returnType == enExcel_FindReturnValue.CellValue) result.Add(item);
                        else result.Add(CellAddress(colNo, rowNo));
                    }
                    colNo++;
                }
                rowNo++;
            }
            return result;
        }

        ///// &lt;summary&gt;Gets all the cells that contain&#39;s |V&gt;|.&lt;/summary&gt;
        ///// &lt;param name=&quot;data&quot;&gt;The data.&lt;/param&gt;
        ///// &lt;returns&gt;&lt;/returns&gt;
        //public List&lt;string&gt; Compile_DownLeftCells(ExcelData_ data)
        //{
        //    return Find(data, &quot;|V&gt;|&quot;, enExcelCompare.Equal, enExcelFindReturnValue.CellAddress);

        //    //var result = new List&lt;string&gt;();
        //    //var rowNo = 1;
        //    //foreach (List&lt;string&gt; row in data.Rows)
        //    //{
        //    //    var colNo = 1;
        //    //    foreach (string cell in row)
        //    //    {
        //    //        if (cell == &quot;|V&gt;|&quot;)
        //    //        {
        //    //            var address = CellAddress(colNo, rowNo, false);  // Todo: fix this macro to do everything
        //    //            result.Add(address);
        //    //        }
        //    //        colNo++;
        //    //    }
        //    //    rowNo++;
        //    //}
        //    //return result;
        //}

        /// &lt;summary&gt;Finds the first occurance.&lt;/summary&gt;
        /// &lt;param name=&quot;data&quot;&gt;The data.&lt;/param&gt;
        /// &lt;param name=&quot;result&quot;&gt;The result.&lt;/param&gt;
        /// &lt;param name=&quot;findValue&quot;&gt;The find value.&lt;/param&gt;
        /// &lt;param name=&quot;compare&quot;&gt;The compare formula to use.&lt;/param&gt;
        /// &lt;param name=&quot;returnType&quot;&gt;Type of the return.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public bool Find_First(pcExcelData_ data, out string result, string findValue = &quot;|-&gt;&quot;, enExcel_Compare compare = enExcel_Compare.Contains,
            enExcel_FindReturnValue returnType = enExcel_FindReturnValue.CellValue)
        {
            result = &quot;&quot;;
            var findList = Find(data, findValue, compare, returnType);
            if (findList.Count == 0) return false;

            result = findList[0];
            return true;
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[20,9,20,10,1],[21,13,21,34,1],[22,13,22,14,1],[23,17,23,31,1],[23,32,23,122,1],[24,17,24,28,1],[27,13,27,41,1],[28,13,28,36,1],[31,13,31,14,1],[32,17,32,50,1],[33,17,33,71,1],[34,17,34,53,1],[35,13,35,14,1],[30,13,30,33,1],[36,13,36,31,1],[37,9,37,10,1],[43,9,43,10,1],[46,13,46,65,1],[48,13,48,28,1],[49,13,49,32,1],[50,18,50,45,1],[51,13,51,14,1],[52,17,52,42,1],[53,17,53,18,1],[54,21,54,62,1],[55,21,55,38,1],[56,17,56,18,1],[57,13,57,14,1],[50,56,50,60,1],[50,47,50,54,1],[58,13,58,27,1],[59,9,59,10,1],[68,9,68,10,1],[69,13,69,29,1],[70,13,70,25,1],[71,13,71,14,1],[72,17,72,30,1],[73,17,73,31,1],[73,32,73,125,1],[74,13,74,14,1],[75,18,75,40,1],[77,13,77,68,1],[78,13,78,46,1],[79,13,79,27,1],[80,9,80,10,1],[86,9,86,10,1],[88,13,88,57,1],[89,13,89,19,1],[90,13,90,42,1],[91,9,91,10,1],[97,9,97,10,1],[99,13,99,57,1],[100,13,100,19,1],[101,13,101,42,1],[102,9,102,10,1],[109,9,109,10,1],[111,13,111,79,1],[112,13,112,34,1],[113,13,113,14,1],[115,17,115,36,1],[116,17,116,25,1],[117,17,117,24,1],[119,13,119,57,1],[120,13,120,56,1],[121,13,121,30,1],[121,31,121,39,1],[122,18,122,43,1],[123,9,123,10,1],[130,9,130,10,1],[132,13,132,62,1],[133,13,133,41,1],[134,9,134,10,1],[142,9,142,10,1],[143,13,143,29,1],[143,30,143,87,1],[144,13,144,26,1],[144,27,144,81,1],[148,13,148,63,1],[149,13,149,47,1],[150,13,150,34,1],[151,13,151,29,1],[153,13,153,50,1],[154,13,154,27,1],[155,9,155,10,1],[164,9,164,10,1],[166,13,166,45,1],[167,13,167,27,1],[168,13,168,20,1],[168,42,168,51,1],[168,22,168,38,1],[169,13,169,14,1],[170,17,170,31,1],[171,17,171,24,1],[171,41,171,44,1],[171,26,171,37,1],[172,17,172,18,1],[173,21,173,40,1],[174,21,174,61,1],[175,21,175,22,1],[176,26,176,55,1],[176,56,176,69,1],[177,21,177,22,1],[178,26,178,48,1],[178,49,178,62,1],[180,21,180,31,1],[181,21,181,22,1],[182,25,182,77,1],[182,78,182,95,1],[183,30,183,68,1],[184,21,184,22,1],[185,21,185,29,1],[186,17,186,18,1],[171,38,171,40,1],[187,17,187,25,1],[188,13,188,14,1],[168,39,168,41,1],[189,13,189,27,1],[190,9,190,10,1],[227,9,227,10,1],[228,13,228,25,1],[229,13,229,71,1],[230,13,230,37,1],[230,38,230,51,1],[232,13,232,34,1],[233,13,233,25,1],[234,9,234,10,1]]);
    </script>
  </body>
</html>