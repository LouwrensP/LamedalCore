<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>d:\dev\lamedal\trunk\lamedalcore\lamedalcore\types\types_intromannumbers.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading.Tasks;

namespace LamedalCore.Types
{
    /// &lt;summary&gt;
    /// http://stackoverflow.com/questions/271398/what-are-your-favorite-extension-methods-for-c-codeplex-com-extensionoverflow
    /// http://stackoverflow.com/users/3312/jesse-c-slicer
    /// &lt;/summary&gt;
    public sealed class Types_intRomanNumbers
    {
        private const int _NumberOfRomanNumeralMaps = 13;
        private const int _MinValue = 1;
        private const int _MaxValue = 3999;
        private readonly Dictionary&lt;string, int&gt; _romanNumerals = new Dictionary&lt;string, int&gt;(_NumberOfRomanNumeralMaps)
            {
                { &quot;M&quot;, 1000 },
                { &quot;CM&quot;, 900 },
                { &quot;D&quot;, 500 },
                { &quot;CD&quot;, 400 },
                { &quot;C&quot;, 100 },
                { &quot;XC&quot;, 90 },
                { &quot;L&quot;, 50 },
                { &quot;XL&quot;, 40 },
                { &quot;X&quot;, 10 },
                { &quot;IX&quot;, 9 },
                { &quot;V&quot;, 5 },
                { &quot;IV&quot;, 4 },
                { &quot;I&quot;, 1 }
            };

        private readonly Regex _validRomanNumeral = new Regex(
            &quot;^(?i:(?=[MDCLXVI])((M{0,3})((C[DM])|(D?C{0,3}))&quot;
            + &quot;?((X[LC])|(L?XX{0,2})|L)?((I[VX])|(V?(II{0,2}))|V)?))$&quot;,
            RegexOptions.Compiled);

        public bool IsValid(string value)
        {
            return _validRomanNumeral.IsMatch(value);
        }

        public int ToInt(string value)
        {
            if (value == null) throw new ArgumentNullException(nameof(value));

            value = value.ToUpperInvariant().Trim();
            int length = value.Length;

            if ((length == 0) || !IsValid(value)) throw new ArgumentException(&quot;Empty or invalid Roman numeral string.&quot;, nameof(value));

            var result = 0;
            var ii = length;

            while (ii &gt; 0)
            {
                int digit = _romanNumerals[value[--ii].ToString()];

                if (ii &gt; 0)
                {
                    int previousDigit = _romanNumerals[value[ii - 1].ToString()];
                    if (previousDigit &lt; digit)
                    {
                        digit -= previousDigit;
                        ii--;
                    }
                }
                result += digit;
            }

            return result;
        }

        public string ToRoman(int value)
        {
            if ((value &lt; _MinValue) || (value &gt; _MaxValue)) throw new ArgumentOutOfRangeException(nameof(value), value, &quot;Argument out of Roman numeral range.&quot;);

            const int MaxRomanNumeralLength = 15;
            var result = new StringBuilder(MaxRomanNumeralLength);

            foreach (var pair in _romanNumerals)
            {
                while (value / pair.Value &gt; 0)
                {
                    result.Append(pair.Key);
                    value -= pair.Value;
                }
            }

            return result.ToString();
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[48,32,48,79,0],[53,51,53,136,0],[79,61,79,161,0],[42,9,42,10,1],[43,13,43,54,1],[44,9,44,10,1],[47,9,47,10,1],[48,13,48,31,1],[50,13,50,53,1],[51,13,51,39,1],[53,13,53,50,1],[55,13,55,28,1],[56,13,56,29,1],[59,13,59,14,1],[60,17,60,68,1],[62,17,62,28,1],[63,17,63,18,1],[64,21,64,82,1],[65,21,65,47,1],[66,21,66,22,1],[67,25,67,48,1],[68,25,68,30,1],[69,21,69,22,1],[70,17,70,18,1],[71,17,71,33,1],[72,13,72,14,1],[58,13,58,27,1],[74,13,74,27,1],[75,9,75,10,1],[78,9,78,10,1],[79,13,79,60,1],[82,13,82,67,1],[84,13,84,20,1],[84,34,84,48,1],[84,22,84,30,1],[85,13,85,14,1],[87,17,87,18,1],[88,21,88,45,1],[89,21,89,41,1],[90,17,90,18,1],[86,17,86,47,1],[91,13,91,14,1],[84,31,84,33,1],[93,13,93,38,1],[94,9,94,10,1],[19,9,34,15,1],[36,9,39,36,1]]);
    </script>
  </body>
</html>